import { db } from '@/server/db'
import {
  alunoTable,
  cursoTable,
  departamentoTable,
  disciplinaProfessorResponsavelTable,
  disciplinaTable,
  enderecoTable,
  periodoInscricaoTable,
  professorTable,
  projetoDisciplinaTable,
  projetoTable,
  userTable,
} from '@/server/db/schema'
import { logger } from '@/utils/logger'

const log = logger.child({ context: 'DatabaseSeed' })



async function seedDatabase() {
  log.info('üå± Iniciando seed do banco de dados...')

  try {
    // 1. Limpar dados existentes (em ordem para evitar conflitos de FK)
    log.info('üßπ Limpando dados existentes...')
    await db.delete(disciplinaProfessorResponsavelTable)
    await db.delete(projetoDisciplinaTable)
    await db.delete(projetoTable)
    await db.delete(periodoInscricaoTable)
    await db.delete(alunoTable)
    await db.delete(professorTable)
    await db.delete(userTable)
    await db.delete(disciplinaTable)
    await db.delete(cursoTable)
    await db.delete(enderecoTable)
    await db.delete(departamentoTable)

    // 2. Criar Departamentos
    log.info('üè¢ Criando departamentos...')
    const departamentos = await db.insert(departamentoTable).values([
      {
        unidadeUniversitaria: 'Instituto de Matem√°tica e Estat√≠stica',
        nome: 'Departamento de Ci√™ncia da Computa√ß√£o',
        sigla: 'DCC',
        coordenador: 'Prof. Dr. Carlos Silva',
        email: 'dcc@ufba.br',
        telefone: '(71) 3283-6666',
        descricao: 'Departamento respons√°vel pelos cursos de Ci√™ncia da Computa√ß√£o',
      },
      {
        unidadeUniversitaria: 'Instituto de Matem√°tica e Estat√≠stica',
        nome: 'Departamento de Matem√°tica',
        sigla: 'MAT',
        coordenador: 'Prof. Dr. Ana Santos',
        email: 'mat@ufba.br',
        telefone: '(71) 3283-6667',
        descricao: 'Departamento respons√°vel pelos cursos de Matem√°tica',
      },
      {
        unidadeUniversitaria: 'Instituto de Matem√°tica e Estat√≠stica',
        nome: 'Departamento de Estat√≠stica',
        sigla: 'EST',
        coordenador: 'Prof. Dr. Jo√£o Oliveira',
        email: 'est@ufba.br',
        telefone: '(71) 3283-6668',
        descricao: 'Departamento respons√°vel pelos cursos de Estat√≠stica',
      },
      {
        unidadeUniversitaria: 'Instituto de F√≠sica',
        nome: 'Departamento de F√≠sica',
        sigla: 'FIS',
        coordenador: 'Prof. Dr. Maria Costa',
        email: 'fis@ufba.br',
        telefone: '(71) 3283-6669',
        descricao: 'Departamento respons√°vel pelos cursos de F√≠sica',
      },
      {
        unidadeUniversitaria: 'Escola Polit√©cnica',
        nome: 'Departamento de Engenharia de Computa√ß√£o',
        sigla: 'COMP',
        coordenador: 'Prof. Dr. Pedro Almeida',
        email: 'comp@ufba.br',
        telefone: '(71) 3283-6670',
        descricao: 'Departamento respons√°vel pelos cursos de Engenharia de Computa√ß√£o',
      },
    ]).returning()

    // 3. Criar Cursos
    log.info('üéì Criando cursos...')
    const cursos = await db.insert(cursoTable).values([
      {
        nome: 'Ci√™ncia da Computa√ß√£o',
        codigo: 500001,
        tipo: 'BACHARELADO',
        modalidade: 'PRESENCIAL',
        duracao: 8,
        departamentoId: departamentos[0].id,
        cargaHoraria: 3000,
        descricao: 'Curso de Bacharelado em Ci√™ncia da Computa√ß√£o',
        coordenador: 'Prof. Dr. Carlos Silva',
        emailCoordenacao: 'coord.cc@ufba.br',
        status: 'ATIVO',
      },
      {
        nome: 'Sistemas de Informa√ß√£o',
        codigo: 500002,
        tipo: 'BACHARELADO',
        modalidade: 'PRESENCIAL',
        duracao: 8,
        departamentoId: departamentos[0].id,
        cargaHoraria: 3000,
        descricao: 'Curso de Bacharelado em Sistemas de Informa√ß√£o',
        coordenador: 'Prof. Dr. Ana Pereira',
        emailCoordenacao: 'coord.si@ufba.br',
        status: 'ATIVO',
      },
      {
        nome: 'Matem√°tica',
        codigo: 500003,
        tipo: 'LICENCIATURA',
        modalidade: 'PRESENCIAL',
        duracao: 8,
        departamentoId: departamentos[1].id,
        cargaHoraria: 3200,
        descricao: 'Curso de Licenciatura em Matem√°tica',
        coordenador: 'Prof. Dr. Ana Santos',
        emailCoordenacao: 'coord.mat@ufba.br',
        status: 'ATIVO',
      },
      {
        nome: 'Estat√≠stica',
        codigo: 500004,
        tipo: 'BACHARELADO',
        modalidade: 'PRESENCIAL',
        duracao: 8,
        departamentoId: departamentos[2].id,
        cargaHoraria: 3000,
        descricao: 'Curso de Bacharelado em Estat√≠stica',
        coordenador: 'Prof. Dr. Jo√£o Oliveira',
        emailCoordenacao: 'coord.est@ufba.br',
        status: 'ATIVO',
      },
      {
        nome: 'F√≠sica',
        codigo: 500005,
        tipo: 'BACHARELADO',
        modalidade: 'PRESENCIAL',
        duracao: 8,
        departamentoId: departamentos[3].id,
        cargaHoraria: 3000,
        descricao: 'Curso de Bacharelado em F√≠sica',
        coordenador: 'Prof. Dr. Maria Costa',
        emailCoordenacao: 'coord.fis@ufba.br',
        status: 'ATIVO',
      },
      {
        nome: 'Engenharia de Computa√ß√£o',
        codigo: 500006,
        tipo: 'BACHARELADO',
        modalidade: 'PRESENCIAL',
        duracao: 10,
        departamentoId: departamentos[4].id,
        cargaHoraria: 3600,
        descricao: 'Curso de Bacharelado em Engenharia de Computa√ß√£o',
        coordenador: 'Prof. Dr. Pedro Almeida',
        emailCoordenacao: 'coord.engcomp@ufba.br',
        status: 'ATIVO',
      },
    ]).returning()

    // 4. Criar Disciplinas
    log.info('üìö Criando disciplinas...')
    const disciplinas = await db.insert(disciplinaTable).values([
      // Disciplinas de Ci√™ncia da Computa√ß√£o
      { nome: 'Introdu√ß√£o √† Programa√ß√£o', codigo: 'MATC99', departamentoId: departamentos[0].id },
      { nome: 'Programa√ß√£o Orientada a Objetos', codigo: 'MATC01', departamentoId: departamentos[0].id },
      { nome: 'Estruturas de Dados', codigo: 'MATC02', departamentoId: departamentos[0].id },
      { nome: 'Algoritmos e Programa√ß√£o', codigo: 'MATC03', departamentoId: departamentos[0].id },
      { nome: 'Banco de Dados', codigo: 'MATC04', departamentoId: departamentos[0].id },
      { nome: 'Engenharia de Software', codigo: 'MATC05', departamentoId: departamentos[0].id },
      { nome: 'Redes de Computadores', codigo: 'MATC06', departamentoId: departamentos[0].id },
      { nome: 'Intelig√™ncia Artificial', codigo: 'MATC07', departamentoId: departamentos[0].id },
      { nome: 'Sistemas Operacionais', codigo: 'MATC08', departamentoId: departamentos[0].id },
      { nome: 'Computa√ß√£o Gr√°fica', codigo: 'MATC09', departamentoId: departamentos[0].id },

      // Disciplinas de Matem√°tica
      { nome: 'C√°lculo I', codigo: 'MATA37', departamentoId: departamentos[1].id },
      { nome: 'C√°lculo II', codigo: 'MATA38', departamentoId: departamentos[1].id },
      { nome: '√Ålgebra Linear', codigo: 'MATA07', departamentoId: departamentos[1].id },
      { nome: 'Geometria Anal√≠tica', codigo: 'MATA08', departamentoId: departamentos[1].id },
      { nome: 'Matem√°tica Discreta', codigo: 'MATA09', departamentoId: departamentos[1].id },

      // Disciplinas de Estat√≠stica
      { nome: 'Estat√≠stica Descritiva', codigo: 'MATE01', departamentoId: departamentos[2].id },
      { nome: 'Probabilidade', codigo: 'MATE02', departamentoId: departamentos[2].id },
      { nome: 'Infer√™ncia Estat√≠stica', codigo: 'MATE03', departamentoId: departamentos[2].id },
      { nome: 'An√°lise de Regress√£o', codigo: 'MATE04', departamentoId: departamentos[2].id },

      // Disciplinas de F√≠sica
      { nome: 'F√≠sica I', codigo: 'FISA01', departamentoId: departamentos[3].id },
      { nome: 'F√≠sica II', codigo: 'FISA02', departamentoId: departamentos[3].id },
      { nome: 'F√≠sica III', codigo: 'FISA03', departamentoId: departamentos[3].id },
      { nome: 'Mec√¢nica Cl√°ssica', codigo: 'FISA04', departamentoId: departamentos[3].id },

      // Disciplinas de Engenharia de Computa√ß√£o
      { nome: 'Circuitos Digitais', codigo: 'COMP01', departamentoId: departamentos[4].id },
      { nome: 'Microprocessadores', codigo: 'COMP02', departamentoId: departamentos[4].id },
      { nome: 'Sistemas Embarcados', codigo: 'COMP03', departamentoId: departamentos[4].id },
      { nome: 'Arquitetura de Computadores', codigo: 'COMP04', departamentoId: departamentos[4].id },
    ]).returning()

    // 5. Criar Endere√ßos
    log.info('üè† Criando endere√ßos...')
    const enderecos = await db.insert(enderecoTable).values([
      {
        numero: 123,
        rua: 'Rua das Flores',
        bairro: 'Federa√ß√£o',
        cidade: 'Salvador',
        estado: 'BA',
        cep: '40170-110',
        complemento: 'Apt 101',
      },
      {
        numero: 456,
        rua: 'Av. Sete de Setembro',
        bairro: 'Corredor da Vit√≥ria',
        cidade: 'Salvador',
        estado: 'BA',
        cep: '40060-001',
        complemento: 'Casa',
      },
      {
        numero: 789,
        rua: 'Rua Jo√£o das Botas',
        bairro: 'Canela',
        cidade: 'Salvador',
        estado: 'BA',
        cep: '40110-160',
        complemento: 'Bloco A',
      },
    ]).returning()

    // 6. Criar Usu√°rios
    log.info('üë§ Criando usu√°rios...')

    const usuarios = await db.insert(userTable).values([
      {
        username: 'admin',
        email: 'admin@ufba.br',
        role: 'admin',
        assinaturaDefault: null,
      },
      {
        username: 'carlos.silva',
        email: 'carlos.silva@ufba.br',
        role: 'professor',
      },
      {
        username: 'ana.pereira',
        email: 'ana.pereira@ufba.br',
        role: 'professor',
      },
      {
        username: 'joao.santos',
        email: 'joao.santos@ufba.br',
        role: 'professor',
      },
      {
        username: 'maria.costa',
        email: 'maria.costa@ufba.br',
        role: 'professor',
      },
      {
        username: 'aluno1',
        email: 'aluno1@ufba.br',
        role: 'student',
      },
      {
        username: 'aluno2',
        email: 'aluno2@ufba.br',
        role: 'student',
      },
      {
        username: 'aluno3',
        email: 'aluno3@ufba.br',
        role: 'student',
      },
      {
        username: 'aluno4',
        email: 'aluno4@ufba.br',
        role: 'student',
      },
    ]).returning()

    // 7. Criar Professores
    log.info('üë®‚Äçüè´ Criando professores...')
    const professores = await db.insert(professorTable).values([
      {
        userId: usuarios[1].id,
        departamentoId: departamentos[0].id,
        nomeCompleto: 'Carlos Silva',
        genero: 'MASCULINO',
        regime: 'DE',
        cpf: '123.456.789-01',
        telefone: '(71) 99999-1234',
        emailInstitucional: 'carlos.silva@ufba.br',
        matriculaSiape: '1234567',
      },
      {
        userId: usuarios[2].id,
        departamentoId: departamentos[0].id,
        nomeCompleto: 'Ana Pereira',
        genero: 'FEMININO',
        regime: 'DE',
        cpf: '123.456.789-02',
        telefone: '(71) 99999-1235',
        emailInstitucional: 'ana.pereira@ufba.br',
        matriculaSiape: '1234568',
      },
      {
        userId: usuarios[3].id,
        departamentoId: departamentos[1].id,
        nomeCompleto: 'Jo√£o Santos',
        genero: 'MASCULINO',
        regime: 'DE',
        cpf: '123.456.789-03',
        telefone: '(71) 99999-1236',
        emailInstitucional: 'joao.santos@ufba.br',
        matriculaSiape: '1234569',
      },
      {
        userId: usuarios[4].id,
        departamentoId: departamentos[3].id,
        nomeCompleto: 'Maria Costa',
        genero: 'FEMININO',
        regime: 'DE',
        cpf: '123.456.789-04',
        telefone: '(71) 99999-1237',
        emailInstitucional: 'maria.costa@ufba.br',
        matriculaSiape: '1234570',
      },
    ]).returning()

    // 8. Criar Alunos
    log.info('üë®‚Äçüéì Criando alunos...')
    const alunos = await db.insert(alunoTable).values([
      {
        userId: usuarios[5].id,
        nomeCompleto: 'Jo√£o da Silva',
        genero: 'MASCULINO',
        emailInstitucional: 'aluno1@ufba.br',
        matricula: '202110001',
        cpf: '123.456.789-05',
        cr: 8.5,
        telefone: '(71) 99999-2001',
        cursoId: cursos[0].id,
        enderecoId: enderecos[0].id,
      },
      {
        userId: usuarios[6].id,
        nomeCompleto: 'Maria Oliveira',
        genero: 'FEMININO',
        emailInstitucional: 'aluno2@ufba.br',
        matricula: '202110002',
        cpf: '123.456.789-06',
        cr: 9.0,
        telefone: '(71) 99999-2002',
        cursoId: cursos[0].id,
        enderecoId: enderecos[1].id,
      },
      {
        userId: usuarios[7].id,
        nomeCompleto: 'Pedro Santos',
        genero: 'MASCULINO',
        emailInstitucional: 'aluno3@ufba.br',
        matricula: '202110003',
        cpf: '123.456.789-07',
        cr: 7.8,
        telefone: '(71) 99999-2003',
        cursoId: cursos[1].id,
        enderecoId: enderecos[2].id,
      },
      {
        userId: usuarios[8].id,
        nomeCompleto: 'Ana Costa',
        genero: 'FEMININO',
        emailInstitucional: 'aluno4@ufba.br',
        matricula: '202110004',
        cpf: '123.456.789-08',
        cr: 8.2,
        telefone: '(71) 99999-2004',
        cursoId: cursos[2].id,
        enderecoId: enderecos[0].id,
      },
    ]).returning()

    // 9. Criar Per√≠odo de Inscri√ß√£o
    log.info('üìÖ Criando per√≠odo de inscri√ß√£o...')
    const periodos = await db.insert(periodoInscricaoTable).values([
      {
        semestre: 'SEMESTRE_1',
        ano: 2025,
        dataInicio: new Date('2025-01-15'),
        dataFim: new Date('2025-02-15'),
      },
      {
        semestre: 'SEMESTRE_2',
        ano: 2025,
        dataInicio: new Date('2025-07-15'),
        dataFim: new Date('2025-08-15'),
      },
    ]).returning()

    // 10. Criar Responsabilidades de Disciplina
    log.info('üìã Criando responsabilidades de disciplina...')
    await db.insert(disciplinaProfessorResponsavelTable).values([
      {
        disciplinaId: disciplinas[0].id, // Introdu√ß√£o √† Programa√ß√£o
        professorId: professores[0].id,  // Carlos Silva
        ano: 2025,
        semestre: 'SEMESTRE_1',
      },
      {
        disciplinaId: disciplinas[1].id, // POO
        professorId: professores[1].id,  // Ana Pereira
        ano: 2025,
        semestre: 'SEMESTRE_1',
      },
      {
        disciplinaId: disciplinas[2].id, // Estruturas de Dados
        professorId: professores[0].id,  // Carlos Silva
        ano: 2025,
        semestre: 'SEMESTRE_1',
      },
      {
        disciplinaId: disciplinas[10].id, // C√°lculo I
        professorId: professores[2].id,   // Jo√£o Santos
        ano: 2025,
        semestre: 'SEMESTRE_1',
      },
      {
        disciplinaId: disciplinas[19].id, // F√≠sica I
        professorId: professores[3].id,   // Maria Costa
        ano: 2025,
        semestre: 'SEMESTRE_1',
      },
    ])

    // 11. Criar Projetos de Monitoria
    log.info('üìã Criando projetos de monitoria...')
    const projetos = await db.insert(projetoTable).values([
      {
        departamentoId: departamentos[0].id,
        ano: 2025,
        semestre: 'SEMESTRE_1',
        tipoProposicao: 'INDIVIDUAL',
        bolsasSolicitadas: 2,
        voluntariosSolicitados: 3,
        cargaHorariaSemana: 12,
        numeroSemanas: 16,
        publicoAlvo: 'Estudantes de Ci√™ncia da Computa√ß√£o cursando disciplinas introdut√≥rias',
        estimativaPessoasBenificiadas: 50,
        professorResponsavelId: professores[0].id,
        titulo: 'Monitoria de Introdu√ß√£o √† Programa√ß√£o',
        descricao: 'Projeto de monitoria para auxiliar estudantes na disciplina de Introdu√ß√£o √† Programa√ß√£o, focando em conceitos fundamentais de programa√ß√£o e resolu√ß√£o de problemas.',
        status: 'APPROVED',
      },
      {
        departamentoId: departamentos[0].id,
        ano: 2025,
        semestre: 'SEMESTRE_1',
        tipoProposicao: 'INDIVIDUAL',
        bolsasSolicitadas: 1,
        voluntariosSolicitados: 2,
        cargaHorariaSemana: 8,
        numeroSemanas: 16,
        publicoAlvo: 'Estudantes de Ci√™ncia da Computa√ß√£o em disciplinas avan√ßadas',
        estimativaPessoasBenificiadas: 30,
        professorResponsavelId: professores[1].id,
        titulo: 'Monitoria de Programa√ß√£o Orientada a Objetos',
        descricao: 'Projeto de monitoria para apoiar estudantes na compreens√£o dos conceitos de programa√ß√£o orientada a objetos, incluindo heran√ßa, polimorfismo e encapsulamento.',
        status: 'SUBMITTED',
      },
      {
        departamentoId: departamentos[1].id,
        ano: 2025,
        semestre: 'SEMESTRE_1',
        tipoProposicao: 'INDIVIDUAL',
        bolsasSolicitadas: 1,
        voluntariosSolicitados: 1,
        cargaHorariaSemana: 10,
        numeroSemanas: 16,
        publicoAlvo: 'Estudantes de diversos cursos que cursam C√°lculo I',
        estimativaPessoasBenificiadas: 80,
        professorResponsavelId: professores[2].id,
        titulo: 'Monitoria de C√°lculo I',
        descricao: 'Projeto de monitoria para auxiliar estudantes em conceitos fundamentais de c√°lculo diferencial e integral, com foco em resolu√ß√£o de exerc√≠cios e esclarecimento de d√∫vidas.',
        status: 'DRAFT',
      },
      {
        departamentoId: departamentos[3].id,
        ano: 2025,
        semestre: 'SEMESTRE_1',
        tipoProposicao: 'INDIVIDUAL',
        bolsasSolicitadas: 1,
        voluntariosSolicitados: 2,
        cargaHorariaSemana: 8,
        numeroSemanas: 16,
        publicoAlvo: 'Estudantes de F√≠sica e Engenharia',
        estimativaPessoasBenificiadas: 40,
        professorResponsavelId: professores[3].id,
        titulo: 'Monitoria de F√≠sica I',
        descricao: 'Projeto de monitoria para apoiar estudantes na compreens√£o dos conceitos de mec√¢nica cl√°ssica, incluindo cinem√°tica, din√¢mica e leis de conserva√ß√£o.',
        status: 'APPROVED',
      },
    ]).returning()

    // 12. Associar Disciplinas aos Projetos
    log.info('üîó Associando disciplinas aos projetos...')
    await db.insert(projetoDisciplinaTable).values([
      {
        projetoId: projetos[0].id,
        disciplinaId: disciplinas[0].id, // Introdu√ß√£o √† Programa√ß√£o
      },
      {
        projetoId: projetos[1].id,
        disciplinaId: disciplinas[1].id, // POO
      },
      {
        projetoId: projetos[2].id,
        disciplinaId: disciplinas[10].id, // C√°lculo I
      },
      {
        projetoId: projetos[3].id,
        disciplinaId: disciplinas[19].id, // F√≠sica I
      },
    ])

    log.info('‚úÖ Seed conclu√≠do com sucesso!')
    log.info(`üìä Dados criados:
      - ${departamentos.length} departamentos
      - ${cursos.length} cursos
      - ${disciplinas.length} disciplinas
      - ${usuarios.length} usu√°rios
      - ${professores.length} professores
      - ${alunos.length} alunos
      - ${periodos.length} per√≠odos de inscri√ß√£o
      - ${projetos.length} projetos de monitoria
    `)

    log.info('üîë Credenciais de acesso:')
    log.info('  Admin: admin@ufba.br / 123456')
    log.info('  Professor: carlos.silva@ufba.br / 123456')
    log.info('  Aluno: aluno1@ufba.br / 123456')

  } catch (error) {
    log.error('‚ùå Erro durante o seed:', error)
    throw error
  }
}

// Executar o seed se chamado diretamente
if (require.main === module) {
  seedDatabase()
    .then(() => {
      log.info('üéâ Seed executado com sucesso!')
      process.exit(0)
    })
    .catch((error) => {
      log.error('üí• Erro ao executar seed:', error)
      process.exit(1)
    })
}

export { seedDatabase }
